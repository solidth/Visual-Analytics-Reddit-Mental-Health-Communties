<!doctype html>
<html lang="en" style="min-width:100vh;min-height:100vh">
<head >
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.84.0">
    <title>Top navbar example · Bootstrap v5.0</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/navbar-static/">


    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <!-- Favicons -->
    <meta name="theme-color" content="#7952b3">


    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
    </style>


    <!-- Custom styles for this template -->
    <link href="css/navbar.css" rel="stylesheet">
</head>
<body class="vh-100" style="overflow:hidden">
<h1 class="bg-dark text-white mb-0 mx-auto p-4">Mental Health Subreddits</h1>
<nav class="navbar navbar-expand-md navbar-dark bg-dark mb-3">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">Top navbar</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
                aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav me-auto mb-2 mb-md-0">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="index.html">Network</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="ipynb/heatmap_test.html">User Overlap Heatmap</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Sentiment</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Hierarchies</a>
                </li>
            </ul>
            <form class="d-flex">
                <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-success" type="submit">Search</button>
            </form>
        </div>
    </div>
</nav>

<main class="d-flex flex-column" style="min-width:90vh;min-height:90vh">
    <div class="d-flex flex-nowrap justify-content-around" style="min-width:100vh;min-height:100vh">
        <div class="p-3 text-bg-dark d-inline-flex col-2">
            <div id="subreddits" style="display:block">
                <h4 style="padding:20px">Lists of Subreddits</h4>
                <ul id="listOfSubreddits">

                </ul>
            </div>
            <button type="button" id="collaps-subreddits"> ⇤ </button>
        </div>
        <div id="visualisationArea" class="bg-light col p-5" >
            <h1>Network</h1>
            <svg id="myPlot" style="min-width:100%;min-height:100%"></svg>


        </div>
        <div class=" p-3 text-bg-dark col-2 d-inline-flex col-2">
            <button type="button" id="collaps-filters"> ⇥ </button>
            <div id="filters" style="display:block">
                <h4 style="padding:20px">Filters</h4>
            </div>

        </div>
    </div>

    <div class="text-bg-dark fixed-bottom">
        Test
    </div>
</main>


<script type="text/javascript" src="js/bootstrap.bundle.js"></script>
<script type="text/javascript" src="js/jquery.js"></script>
<!--<script type="module" src="js/papaparse.js"></script>-->
<script type="text/javascript" src="js/jquery.csv.js"></script>
<script type="text/javascript" src="js/d3.v7.js"></script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.2/papaparse.js"></script>


<script>
    d3.json("/data/UserOverlapDataPrepaired.json").then(function (data) {
        console.log(data);


        // Specify the dimensions of the chart.
        const width = $('#myPlot').width();
        const height = $('#myPlot').height();

        // Specify the color scale.
        const color = d3.scaleSequential()
            .interpolator(d3.interpolateInferno)
            .domain([1, 100]);

        // The force simulation mutates links and nodes, so create a copy
        // so that re-evaluating this cell produces the same result.
        const links = data.links.map(d => ({...d}));
        const nodes = data.nodes.map(d => ({...d}));

        // Create a simulation with several forces.
        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id))
            .force("charge", d3.forceManyBody())
            .force("center", d3.forceCenter(width / 2, height / 2.5))
            .on("tick", ticked);

        // Create the SVG container.
        const svg = d3.select("#myPlot")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .attr("viewBox", [0, 0, width, height])
            .attr("style", "max-width: 100%; height: auto;");

        // Add a line for each link, and a circle for each node.
        const link = svg.append("g")
            .attr("stroke", "black")
            .attr("stroke-opacity", 0.6)
            .selectAll()
            .data(links)
            .join("path")
            .attr("stroke-width", d => Math.sqrt(d.value))
            .attr('fill', 'none');

        svg.append('defs').selectAll('marker')
            .data(['suit', 'licensing', 'resolved'])
            .enter().append('marker')
            .attr('id', 'arrow')
            .attr('viewBox', '0 -5 10 10')
            .attr('refX', 20)
            .attr('refY', 0)
            .attr('markerWidth', 6)
            .attr('markerHeight', 6)
            .attr('orient', 'auto')
            .append('path')
            .attr('d', 'M0,-5L10,0L0,5');

        const node = svg.append("g")
            .attr("stroke", "#fff")
            .attr("stroke-width", 1.5)
            .selectAll()
            .data(nodes)
            .join("circle")
            .attr("r", 5)
            .attr("fill", d => color(d.group));

        const text = svg.append("g")
            .attr("x", 6)
            .attr("dy", 15)
            .style('font-size', 10)
            .selectAll()
            .data(links)
            .join("text")
        text.append("textPath")
            .attr("xlink:href",d => "#" + d.source.id + d.target.id)
            .attr('text-anchor', 'middle')
            .attr('startOffset', "50%")
            .text(d => String(d.value.toFixed(2)));

        node.append("title")
            .text(d => d.id);

        // Add a drag behavior.
        node.call(d3.drag()
            .on("start", dragstarted)
            .on("drag", dragged)
            .on("end", dragended));

        // Makes the links curved
        function linkArc(d) {
            var dx = d.target.x - d.source.x,
                dy = d.target.y - d.source.y,
                dr = Math.sqrt(dx * dx + dy * dy);
            return "M" + d.source.x + "," + d.source.y + "A" + dr + "," + dr + " 0 0,1 " + d.target.x + "," + d.target.y;
        }

        // // Set the position attributes of links and nodes each time the simulation ticks.
        function ticked() {
            link
                .attr('d', d => linkArc(d));
            node
                .attr('cx', d => d.x)
                .attr('cy', d => d.y);
        }

        // Reheat the simulation when drag starts, and fix the subject position.
        function dragstarted(event) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            event.subject.fx = event.subject.x;
            event.subject.fy = event.subject.y;
        }

        // Update the subject (dragged node) position during drag.
        function dragged(event) {
            event.subject.fx = event.x;
            event.subject.fy = event.y;
        }

        // Restore the target alpha so the simulation cools after dragging ends.
        // Unfix the subject position now that it’s no longer being dragged.
        function dragended(event) {
            if (!event.active) simulation.alphaTarget(0);
            event.subject.fx = null;
            event.subject.fy = null;
        }

        const selectedNodeText = svg.append("text")
            .attr("x", 10)
            .attr("y", 20)
            .attr("font-size", "14px")
            .attr("fill", "black")
            .text("");

        // Define a function to handle node click events
        function handleNodeClick(event, node, svg) {

            // Retrieve the selected node's ID
            const selectedNodeId = node.id;
            

            // Update the text to display the name of the selected node
            selectedNodeText.text(`Selected Node: ${selectedNodeId}`);

            // Filter links to find connected links
            const connectedLinks = links.filter((link) => link.source.id === selectedNodeId || link.target.id === selectedNodeId);

            function onlyUnique(value, index, array) {
                return array.indexOf(value) === index;
            }

            // console.log("hier", connectedLinks);
            // console.log("hier", connectedLinks.map((obj) => ["<li id='" + obj.target.id + "'>" + obj.target.id + "</li>", "<li id='" + obj.source.id + "'>" + obj.source.id + "</li>"]).join().split(",").filter(onlyUnique));

            $("#listOfSubreddits").html(connectedLinks
                .map((obj) =>
                    ["<li id='" + obj.target.id + "'><a href='#'>" + obj.target.id + "</a></li>",
                        "<li id='" + obj.source.id + "'><a href='#'>" + obj.source.id + "</a></li>"])
                .join().split(",").filter(onlyUnique).join(""));

            // Highlight connected links
            svg.selectAll("path")
                .attr("stroke-opacity", d => connectedLinks.includes(d) ? 1 : 0.2)
                .attr("stroke-width", d => connectedLinks.includes(d) ? 1 : Math.sqrt(d.value))
                .attr('marker-end', d => connectedLinks.includes(d) ? "url(#arrow)" : null)
                .attr('id', d => connectedLinks.includes(d) ? d.source.id + d.target.id : null);

            // Highlight connected nodes (source and target)
            svg.selectAll("circle")
                .attr("fill-opacity", d => d.id === selectedNodeId ? 1 : connectedLinks.some(link => link.source.id === d.id || link.target.id === d.id) ? 1 : 0.2)
                .attr("fill", d => d.id === selectedNodeId ? "red" : "black")
                .attr("r", d => d.id === selectedNodeId ? 6 : connectedLinks.some(link => link.source.id === d.id || link.target.id === d.id) ? 6 : 5)

            ;
        }

        // Add event listeners to nodes
        svg.selectAll("circle")
            .on("click", (event, d) => handleNodeClick(event, d, svg));

        // d3.selectAll("li").on("click", (event, this.id) =>  handleNodeClick(event, this.id, svg));


        // When this cell is re-run, stop the previous simulation. (This doesn’t
        // really matter since the target alpha is zero and the simulation will
        // stop naturally, but it’s a good practice.)
        // invalidation.then(() => simulation.stop());

        // svg.node();

        $("li").on("click", function(){
            console.log("clicki")
        });

        /*
        $( "a" ).on( "click", function() {
            alert("this");
        } );
        */

    });





    // var parsed_data;
    //
    // Papa.parse("submissions_preprocessed_reduced.csv", {
    //     download: true,
    //     header: true,
    //     delimiter: ",",
    //     linebreak: "\n",
    //     complete: function (results) {
    //         // Save result in a globally accessible var
    //         parsed_data = results;
    //         console.log(parsed_data.data);
    //     }
    // });


    function collapsPanels(idOfButton, idOfPanel) {
        $(idOfButton).click(function () {
            this.classList.toggle("active");

            var content = $(idOfPanel)[0];
            console.log(content);
            var parent = $(idOfPanel).parent();
            console.log(parent)
            if (content.style.display === "block") {
                content.style.display = "none";
                parent.removeClass("col-2");
                if(idOfButton === '#collaps-subreddits') {
                    $(idOfButton).html('⇥');
                }
                else if(idOfButton === '#collaps-filters') {
                    $(idOfButton).html('⇤');
                }
            } else {
                content.style.display = "block";
                parent.addClass("col-2");
                if(idOfButton === '#collaps-subreddits') {
                    $(idOfButton).html('⇤');
                }
                else if(idOfButton === '#collaps-filters') {
                    $(idOfButton).html('⇥');
                }
            }
        });
    }

    collapsPanels("#collaps-subreddits", "#subreddits");
    collapsPanels("#collaps-filters", "#filters");

</script>


</body>
</html>
